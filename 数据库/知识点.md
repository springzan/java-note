知识点1，在数据库编程时，尽量用try…catch…finally的代码结构，同时在finally里放置释放数据库连接等资源的代码，因为如果我们不主动地关闭数据库连接，这部分所占用的内存是无法被垃圾回收器（GC）主动回收的。

知识点2，为了提升数据库操作的性能，我会用到PreparedStatement来进行批处理操作，但每批执行的SQL语句的数量不能太多，否则会把缓冲区撑爆，一般每批是500条左右。

知识点3，通过PreparedStatement的预处理机制，我们可以有效地防止SQL注入。


对于合格的程序员，需要有基本的数据库操作技能，具体体现在以下三个方面。

l  第一，针对一类数据库（比如MySQL、Oracle、SQL Server等），会基本的增删改查操作，会用一些基本的函数，会编写存储过程触发器索引等工具。

l  第二，知道一些基本的对项目开发有帮助的概念，比如范式、索引、分区等。

l  第三，能编写一些相对复杂的SQL语句，比如带连接、带子查询、嵌套查询等。

对于高级程序员，用过的数据库种类当然是越多越好，此外，还要掌握如下三大方面的能力。

l  第一，能设计出各类复杂的SQL语句来满足项目中的各类需求。

l  第二，能根据项目情况，自主地设计数据表结构，并能合理地配置外键和主键。

l  第三，也是最重要的，要有一定的数据库调优能力，比如能合理地创建表结构，能正确地创建索引，而且能通过使用索引合理地优化数据库性能，能通过执行计划分析并优化SQL。


第一，如果在设计的时候，已经明确地知道这个系统的数据量不会太大，比如一个中学的图书管理系统，最多有5万条书本的数据，过去一个月里借阅记录不会超过1千条。也就是说，表之间的关联代价不会太高，那么用“三范式”的原则是必需的。毕竟三范式能避免数据冗余带来的更新插入上的“需要同时多表里相同字段”的麻烦。

        第二，如果表的数据量很大，如前面举的在线购物网站的例子，我们可能就需要冗余数据。在订单流水表里，同时放入用户邮件地址和商品名的字段。

        在得到“免去连接操作”的好处同时，也得付出相应的代价，比如用户一旦更新了邮件地址，那么我们就需要同时在会员表和订单流水表里修改该字段，这就是冗余带来的后果。

        

       也就是说，我在询问如何设计数据表时，我不在乎你之前设计过哪些表？关键看你在设计表的时候需要考虑哪些因素。

       大家不仅需要掌握诸如“连接”和“范式”之类的技术，更应该从业务角度，权衡各种“建表代价”，从而挑选一种最符合本项目的解决方案。


### 用try…catch…finally从句
1  用try…catch…finally从句
       根据这个从句的特性，不论是否发生异常，不论发生何种异常，finally从句一定会执行（除非用System.exit退出）。

        根据这个特性，需要把关闭JDBC对象部分的代码写到finally从句里。

        同时，在try…catch里应该注意如下三点：

        第一，不能直接用Exception来接收所有异常，应当先用专业的异常处理类，比如SQLException来接收，最后再用Exception来做最后的防守。

      第二，在catch从句里，别什么都不做，也别直接抛出异常了事，应该返回一些有可操作性的语句，提示用户在遇到异常时该怎么办，比如给出联系人的电话。

     第三，因为监听和检测异常是需要代价的，所以应当尽量缩小try…catch的范围，只包括必要的代码即可，而不是把整个函数都包含在try…catch从句里。

      大家别小看上述非常通俗易懂的原则。作者在某个大公司工作时，曾加过一个项目的评审团队，该公司所有的项目在上线前都要经过这个团队评审打分，如果分数达不到标准，就需要整改代码。

      刚提到的这些原则都是具体的打分项，这个大公司是著名外企，其中的员工都很优秀，但在异常处理点上失分是普遍现象。换句话说，如果大家在面试中说出上述的说辞，一定会让面试官对大家刮目相看。

###  预处理和批处理

    你有没有用过PreparedStatement对象？PreparedStatement和Statement有什么差别？

    请大家说清楚两点，1 提升效率，2 避免SQL注入，从而保证系统的安全

    处理对象PrepareStatement能有效防止这个现象的发生，因为一个“?”就是一个占位符，无法扩展
    ① 在PrepareStatement里，占位符的编号是从1开始，而不是从0开始。
    ② 批量操作能提升效率，但一次性操作多少，才能让效率提升到最高？这在不同的数据库里是不同的，一般是每批操作500到1000条语句。但切记，别一次性把所有的insert语句都用addBatch放入，因为如果SQL语句过多，会撑爆缓存，从而出错。

  PrepareStatement是个比较重要的JDBC对象。再重复一下，我们在面试的时候，有时会问这个问题：Statement和PrepareStatement有什么差别？答案要点是PrepareStatement能预处理，如果能展开一下，说明能防止SQL注入就更好了。

       总结一下，这里大家可以通过叙述代码里的要点来阐释自己在JDBC方面的能力。

       1 阐述try...catch...finally的用法。

       2 详细阐述PreparedStatement的用法，包括预处理批处理和SQL注入两点。